/**
 * Page Processor for server
 * PlannerFw Exec v2.1.0
 * Copyright 2015-2016 W3plan Technologies, http://w3plan.net
 * Licensed under the GNU GPLv3 license <http://www.gnu.org/copyleft/gpl.html>
 */

/**
 * Page Processor configuration
 * 
 */
var pfConfig = {
	/**
	 * Set application environment either Development or Production
	 * default value is Development
	 * 
	 */
	environment : "Development",
	
	/**
	 * Set current file path started from website root
	 *  
	 */
	processorPath : "/app",
		
	/**
	 * Set site default template URL, when variable pftml is one of 
	 * undefined, 'template', '/template', 'template/' or '/template/',  
	 * this variable would be used to retrieve template
	 *
	 */
	defaultTemplate : "/template/pfm/a/index.html.js",
	
	/**
	 * Set site default template layout URL. When variable pftml is
     * one of 'layout', '/layout', 'layout/' or '/layout/',  
	 * this variable would be used to retrieve layout template
	 *
	 */
	defaultLayout : "/layout/pfm/a/index.html.js",
	
    /**
	 * An server-side file to display error message or to log client errors of production environment
	 * File extension varies depending on web servers 
     *
     * If server isn't PHP, replace it with related file 
     *
	 */
    clientErrorHandler: "/errors/php/client-error-handler.php",
	
	/**
	 * Set maximum seconds to store key/value pairs in Session Storage
	 * under PlannerFw storing mechanisms
	 *
	 */
	storeMaxAge : 1800,
	
	/**
	 * Set to track elapsed time 
	 *
	 */
	trackExecutedTime : true
};

/**
 * Processes start
 * 
 */
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[f]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var f=0;return $jscomp.iteratorPrototype(function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,f){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var b=d++;return{value:f(b,a[b]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,f,d,e){if(f){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var b=a[e];b in d||(d[b]={});d=d[b]}a=a[a.length-1];e=d[a];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var pfConfig={environment:"Development",processorPath:"/app",defaultTemplate:"/template/pfm/a/index.html.js",defaultLayout:"/layout/pfm/a/index.html.js",clientErrorHandler:"/errors/php/client-error-handler.php",storeMaxAge:1800,trackExecutedTime:!0};
(function(){function a(){pfConfig.trackExecutedTime&&planner.updateTrackTime(b.start);var a="Template";"/layout"==b.temp.substr(0,7).toLowerCase()&&(a="LayoutTemplate");b.xhr=planner.getRequestObj(a,b.temp,pfConfig.isProduct);b.xhr.onreadystatechange=function(){if(4==b.xhr.readyState)if(200==b.xhr.status||203==b.xhr.status){var a=b.xhr.responseText;pfConfig.trackExecutedTime&&planner.updateTrackTime(b.start);var c=planner.getValidRetrieveUrls(a,pfConfig.storeMaxAge),h=c.length;0<h?f(0,h,c,d,a):d(a)}else throw Error("Error to access external resource, the processes stopped");
};b.xhr.ontimeout=function(){planner.errorHandler(2,"Request Timeout")};b.xhr.onerror=function(){throw Error("Error to access external resource, the processes stopped");}}function f(a,c,d,e,g){b.xhrs[a]=planner.getRequestObj("PFCSS",d[a],pfConfig.isProduct);b.xhrs[a].onreadystatechange=function(){4==b.xhrs[a].readyState&&(200!=b.xhrs[a].status&&203!=b.xhrs[a].status||planner.updateUrlStorage(d[a],b.xhrs[a].responseText),a+1<c?f(a+1,c,d,e,g):e(g))}}function d(a){pfConfig.trackExecutedTime&&planner.updateTrackTime(b.start);
eval(a);a=pfTemp(c.pfDataSet,planner);document.write(a);document.close();pfConfig.trackExecutedTime&&(planner.updateTrackTime(b.start,!0),planner.errorHandler(3,planner.getElapsedTime(b.start)));b=pfTemp=c=null;pfConfig.isProduct&&(planner=null);pfConfig=null}var e=0;pfConfig.isProduct=!1;"production"==pfConfig.environment.toLowerCase()&&(e=1,pfConfig.isProduct=!0);window.onerror=function(a,b,c,d,f){c=c||"";"PfStop"!=a.slice(-6)&&(window.location.href=pfConfig.clientErrorHandler+"?level=&msg="+encodeURIComponent(a)+
"&line="+c+"&log="+e)};if(!window.planner)throw Error("Failed to load Processor Library");planner.checkEnvironment();var b={},c=null,pfTemp=null;pfConfig.trackExecutedTime&&(b.start=planner.startWatch(),planner.updateTrackTime(0));"/"!==pfConfig.processorPath.substr(0,1)?pfConfig.processorPath="/"+pfConfig.processorPath:"/"===pfConfig.processorPath.substr(-1)&&(pfConfig.processorPath=pfConfig.processorPath.slice(0,-1));b.temp=null;b.layout=null;b.layoutObj=null;b.xhrs={};b.isXmodel=!1;if(window.pftml&&
1<window.pftml.trim().length)if(window.pftml&&"/"!==window.pftml.substr(0,1)&&(window.pftml="/"+window.pftml),"/template"==window.pftml.substr(0,9).toLowerCase()||"/layout"==window.pftml.substr(0,7))b.temp=window.pftml;else throw Error("Template has to be from template or layout subdirectory of web site");else b.temp=pfConfig.defaultTemplate;pfConfig.isProduct&&planner.deleteCookie("pf_times");!window.pfmdl||"string"!==typeof window.pfmdl&&"object"!==typeof window.pfmdl?window.pfxmdl&&"string"===
typeof window.pfxmdl?(c=window.pfxmdl,b.isXmodel=!0):planner.errorHandler(2,"There is no model output"):c=window.pfmdl;if(b.isXmodel)var g=planner.string2Xml(c),g=planner.xml2Json(g),l=Object.keys(g)[0],c=g[l];pfConfig.trackExecutedTime&&planner.updateTrackTime(b.start);(function(){c=planner.responseJsonEncode(c);planner.checkResponseData(c);-1!==document.cookie.indexOf("pf_auth_token")&&planner.getCookie("pf_auth_token")&&(b.tokenFlag=!0);c.hasOwnProperty("jwtClaim")&&c.jwtClaim&&c.hasOwnProperty("jwt")&&
10<c.jwt.length?(planner.setCookie("pf_auth_token",c.jwt),b.tokenFlag=!0):c.hasOwnProperty("jwtClaim")&&!c.jwtClaim&&b.tokenFlag&&(planner.deleteCookie("pf_auth_token"),b.tokenFlag=!1);c.hasOwnProperty("errorLevel")&&c.hasOwnProperty("errorMessage")&&planner.errorHandler(c.errorLevel,c.errorMessage);var d=c.pfDataSet,e=planner.getCookie("pfDataKey");e&&planner.deleteCookie("pfDataKey");d&&planner.secureModel(d,e);c.pfDataSet=d;a()})()})();
