/**
 * Page Processor
 * PlannerFw Exec v2.1.0
 * Copyright 2015-2016 W3plan Technologies, http://w3plan.net
 * Licensed under the GNU GPLv3 license <http://www.gnu.org/copyleft/gpl.html>
 */
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[e]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var e=0;return $jscomp.iteratorPrototype(function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,e){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var d=0,f={next:function(){if(d<b.length){var h=d++;return{value:e(h,b[h]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(b,e,d,f){if(e){d=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var h=b[f];h in d||(d[h]={});d=d[h]}b=b[b.length-1];f=d[b];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
(function(){function b(){var b=a.model?a.method?planner.getRequestObj("Model",a.model,pfConfig.isProduct,a.method):planner.getRequestObj("Model",a.model,pfConfig.isProduct):planner.getRequestObj("XModel",a.xmodel,pfConfig.isProduct,"","xml");b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status||203==b.status)if(a.model)c=b.responseText,d();else if(b.responseXML){var g=planner.xml2Json(b.responseXML),p=Object.keys(g)[0];c=g[p];d()}else planner.errorHandler(2,"Invalid request for XML");
else throw Error("Error to access external resource, the processes stopped");};b.ontimeout=function(){planner.errorHandler(2,"Request Timeout")};b.onerror=function(){throw Error("Error to access external resource, the processes stopped");}}function e(b){if(window.WebSocket&&"function"===typeof window.WebSocket){var g=new WebSocket(b);g.onmessage=function(b){if(a.model)c=b.data;else{b=planner.string2Xml(b.data);b=planner.xml2Json(b);var n=Object.keys(b)[0];c=b[n]}g=null;d()};g.onerror=function(a){g=
null;planner.errorHandler(2,"A WebSocket error occurred")};g.ontimeout=function(a){g=null}}else planner.errorHandler(2,"Your browser does not support WebSocket")}function d(){c=planner.responseJsonEncode(c);planner.checkResponseData(c);-1!==document.cookie.indexOf("pf_auth_token")&&planner.getCookie("pf_auth_token")&&(a.tokenFlag=!0);c.hasOwnProperty("jwtClaim")&&c.jwtClaim&&c.hasOwnProperty("jwt")&&10<c.jwt.length?(planner.setCookie("pf_auth_token",c.jwt),a.tokenFlag=!0):c.hasOwnProperty("jwtClaim")&&
!c.jwtClaim&&a.tokenFlag&&(planner.deleteCookie("pf_auth_token"),a.tokenFlag=!1);c.hasOwnProperty("errorLevel")&&c.hasOwnProperty("errorMessage")&&planner.errorHandler(c.errorLevel,c.errorMessage);var b=c.pfDataSet,g=planner.getCookie("pfDataKey");g&&planner.deleteCookie("pfDataKey");b&&planner.secureModel(b,g);c.pfDataSet=b;f()}function f(){pfConfig.trackExecutedTime&&planner.updateTrackTime(a.start);var b="Template";"/layout"==a.temp.substr(0,7).toLowerCase()&&(b="LayoutTemplate");a.xhr=planner.getRequestObj(b,
a.temp,pfConfig.isProduct);a.xhr.onreadystatechange=function(){if(4==a.xhr.readyState)if(200==a.xhr.status||203==a.xhr.status){var b=a.xhr.responseText;pfConfig.trackExecutedTime&&planner.updateTrackTime(a.start);var c=planner.getValidRetrieveUrls(b,pfConfig.storeMaxAge),d=c.length;0<d?h(0,d,c,k,b):k(b)}else throw Error("Error to access external resource, the processes stopped");};a.xhr.ontimeout=function(){planner.errorHandler(2,"Request Timeout")};a.xhr.onerror=function(){throw Error("Error to access external resource, the processes stopped");
}}function h(b,c,d,e,f){a.xhrs[b]=planner.getRequestObj("PFCSS",d[b],pfConfig.isProduct);a.xhrs[b].onreadystatechange=function(){4==a.xhrs[b].readyState&&(200!=a.xhrs[b].status&&203!=a.xhrs[b].status||planner.updateUrlStorage(d[b],a.xhrs[b].responseText),b+1<c?h(b+1,c,d,e,f):e(f))}}function k(b){pfConfig.trackExecutedTime&&planner.updateTrackTime(a.start);eval(b);b=pfTemp(c.pfDataSet,planner);document.write(b);document.close();pfConfig.trackExecutedTime&&(planner.updateTrackTime(a.start,!0),planner.errorHandler(3,
planner.getElapsedTime(a.start)));a=pfTemp=c=null;pfConfig.isProduct&&(planner=null);pfConfig=null}var m=0;pfConfig.isProduct=!1;"production"==pfConfig.environment.toLowerCase()&&(m=1,pfConfig.isProduct=!0);window.onerror=function(a,b,c,d,e){c=c||"";"PfStop"!=a.slice(-6)&&(window.location.href=pfConfig.clientErrorHandler+"?level=&msg="+encodeURIComponent(a)+"&line="+c+"&log="+m)};if(!window.planner)throw Error("Failed to load Processor Library");planner.checkEnvironment();var a={},c=null,pfTemp=null;pfConfig.trackExecutedTime&&
(a.start=planner.startWatch(),planner.updateTrackTime(0));"/"!==pfConfig.processorPath.substr(0,1)?pfConfig.processorPath="/"+pfConfig.processorPath:"/"===pfConfig.processorPath.substr(-1)&&(pfConfig.processorPath=pfConfig.processorPath.slice(0,-1));a.rurl=decodeURIComponent(window.location.href).trim();a.lowrurl=a.rurl.toLowerCase();a.isWebsoket=!1;a.tokenFlag=!1;a.temp=null;a.layout=null;a.layoutObj=null;a.model=null;a.method=null;a.xmodel=null;a.suppl="";a.xhrs={};if(-1===a.lowrurl.indexOf("?tml=")||
-1===a.lowrurl.indexOf("&mdl=")&&-1===a.lowrurl.indexOf("&xmdl=")||!(a.lowrurl.indexOf("?tml=")<a.lowrurl.indexOf("&mdl=")||a.lowrurl.indexOf("?tml=")<a.lowrurl.indexOf("&xmdl=")))/\?tml=\/?template\/?.*/i.test(a.rurl)?(a.temp=a.rurl.substr(a.rurl.indexOf("?tml=")+5),a.temp&&"/"!==a.temp.substr(0,1)&&(a.temp="/"+a.temp),11>a.temp.length&&(a.temp=pfConfig.defaultTemplate),a.model=pfConfig.defaultModel):/\?tml=\/?layout\/?.*/i.test(a.rurl)?(a.temp=a.rurl.substr(a.rurl.indexOf("?tml=")+5),a.temp&&"/"!==
a.temp.substr(0,1)&&(a.temp="/"+a.temp),9>a.temp.length&&(a.temp=pfConfig.defaultLayout),a.model=pfConfig.defaultLayoutModel):/\?mdl=[^\/]+/i.test(a.lowrurl)?(a.temp=pfConfig.defaultTemplate,a.model=a.rurl.substr(a.rurl.indexOf("?mdl=")+5)):/\?xmdl=[^\/]+/i.test(a.lowrurl)?(a.temp=pfConfig.defaultTemplate,a.model=a.rurl.substr(a.rurl.indexOf("?xmdl=")+6)):(a.temp=pfConfig.defaultTemplate,a.model=pfConfig.defaultModel);else{a.qstr=a.rurl.substr(a.rurl.indexOf("?")+1);if(-1!==a.lowrurl.indexOf("&mdl="))a.model=
a.qstr.substr(a.qstr.indexOf("&mdl=")+5),a.model&&"/"!=a.model&&("ws://"==a.model.substr(0,5).toLowerCase()||"wss://"==a.model.substr(0,6).toLowerCase()?(a.model=a.model.replace("...",window.location.hostname),-1!==a.model.indexOf("/",6)&&(a.suppl=a.model.substr(a.model.indexOf("/",6)),a.model=a.model.substring(0,a.model.indexOf("/",6))),"://"==a.model.substr(a.model.lastIndexOf(":"),3)&&(a.model+=":"+pfConfig.defaultWebsocketPort),a.isWebsoket=!0):-1!==a.model.toLowerCase().indexOf("method=get")?
a.model=a.model.replace(/\?method=get&/gi,"?").replace(/\?method=get/gi,"").replace(/&method=get/gi,""):-1!==a.model.toLowerCase().indexOf("method=post")?(a.method="post",a.model=a.model.replace(/\?method=post&/gi,"?").replace(/\?method=post/gi,"").replace(/&method=post/gi,"")):-1!==a.model.toLowerCase().indexOf("method=put")?(a.method="put",a.model=a.model.replace(/\?method=put&/gi,"?").replace(/\?method=put/gi,"").replace(/&method=put/gi,"")):-1!==a.model.toLowerCase().indexOf("method=delete")&&
(a.method="delete",a.model=a.model.replace(/\?method=delete&/,"?").replace(/\?method=delete/,"").replace(/&method=delete/,"")),planner.checkAllowedRequest(a.model)),a.tempField=a.qstr.substr(0,a.qstr.indexOf("&mdl=")),a.temp=a.tempField.substr(a.tempField.indexOf("=")+1);else if(-1!==a.lowrurl.indexOf("&xmdl=")){a.xmodel=a.qstr.substr(a.qstr.indexOf("&xmdl=")+6);if(a.xmodel&&"/"!=a.xmodel){if("ws://"==a.xmodel.substr(0,5).toLowerCase()||"wss://"==a.xmodel.substr(0,6).toLowerCase())a.xmodel=a.xmodel.replace("...",
window.location.hostname),-1!==a.xmodel.indexOf("/",6)&&(a.suppl=a.xmodel.substr(a.xmodel.indexOf("/",6)),a.xmodel=a.xmodel.substring(0,a.xmodel.indexOf("/",6))),"://"==a.xmodel.substr(a.xmodel.lastIndexOf(":"),3)&&(a.xmodel+=":"+pfConfig.defaultWebsocketPort),a.isWebsoket=!0;planner.checkAllowedRequest(a.xmodel)}a.tempField=a.qstr.substr(0,a.qstr.indexOf("&xmdl="));a.temp=a.tempField.substr(a.tempField.indexOf("=")+1)}a.temp&&"/"!==a.temp.substr(0,1)&&(a.temp="/"+a.temp);a.temp&&"/"!=a.temp?"/layout"==
a.temp.toLowerCase()||"/layout/"==a.temp.toLowerCase()?a.temp=pfConfig.defaultLayout:"/template"==a.temp.toLowerCase()||"/template/"==a.temp.toLowerCase()?a.temp=pfConfig.defaultTemplate:planner.checkAllowedRequest(a.temp):a.temp=pfConfig.defaultTemplate}pfConfig.isProduct&&planner.deleteCookie("pf_times");pfConfig.trackExecutedTime&&planner.updateTrackTime(a.start);c?d():a.isWebsoket?e(a.model?a.model+a.suppl:a.xmodel+a.suppl):b()})();
